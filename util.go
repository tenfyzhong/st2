package st2

import (
	"strings"

	"github.com/iancoleman/strcase"
)

var numbers = map[rune]bool{
	'0': true,
	'1': true,
	'2': true,
	'3': true,
	'4': true,
	'5': true,
	'6': true,
	'7': true,
	'8': true,
	'9': true,
}

var tokens = map[rune]bool{
	'0': true,
	'1': true,
	'2': true,
	'3': true,
	'4': true,
	'5': true,
	'6': true,
	'7': true,
	'8': true,
	'9': true,
	'a': true,
	'b': true,
	'c': true,
	'd': true,
	'e': true,
	'f': true,
	'g': true,
	'h': true,
	'i': true,
	'j': true,
	'k': true,
	'l': true,
	'm': true,
	'n': true,
	'o': true,
	'p': true,
	'q': true,
	'r': true,
	's': true,
	't': true,
	'u': true,
	'v': true,
	'w': true,
	'x': true,
	'y': true,
	'z': true,
	'A': true,
	'B': true,
	'C': true,
	'D': true,
	'E': true,
	'F': true,
	'G': true,
	'H': true,
	'I': true,
	'J': true,
	'K': true,
	'L': true,
	'M': true,
	'N': true,
	'O': true,
	'P': true,
	'Q': true,
	'R': true,
	'S': true,
	'T': true,
	'U': true,
	'V': true,
	'W': true,
	'X': true,
	'Y': true,
	'Z': true,
	'_': true,
}

var acronyms = map[string]bool{
	"ACL":   true,
	"API":   true,
	"ASCII": true,
	"CPU":   true,
	"CSS":   true,
	"DNS":   true,
	"EOF":   true,
	"GUID":  true,
	"HTML":  true,
	"HTTP":  true,
	"HTTPS": true,
	"ID":    true,
	"IP":    true,
	"JSON":  true,
	"LHS":   true,
	"QPS":   true,
	"RAM":   true,
	"RHS":   true,
	"RPC":   true,
	"SLA":   true,
	"SMTP":  true,
	"SQL":   true,
	"SSH":   true,
	"TCP":   true,
	"TLS":   true,
	"TTL":   true,
	"UDP":   true,
	"UI":    true,
	"UID":   true,
	"UUID":  true,
	"URI":   true,
	"URL":   true,
	"UTF8":  true,
	"VM":    true,
	"XML":   true,
	"XMPP":  true,
	"XSRF":  true,
	"XSS":   true,
}

func camel(s string) string {
	items := strings.Split(s, "_")
	for i, item := range items {
		if len(item) == 0 {
			continue
		}
		items[i] = strings.ToUpper(item[0:1]) + item[1:]
	}
	return strings.Join(items, "")
}

func snake(s string) string {
	return strcase.ToSnake(s)
}

func init() {
	for str := range acronyms {
		strcase.ConfigureAcronym(str, strings.ToLower(str))
	}
}

func normalizeToken(token string, emptyDefault string) string {
	runes := []rune(token)
	index := 0
	for i := 0; i < len(runes); i++ {
		if tokens[runes[i]] {
			runes[index] = runes[i]
			index++
		}
	}
	runes = runes[:index]

	token = string(runes)

	if len(runes) == 0 {
		return emptyDefault
	}

	if numbers[runes[0]] {
		return "N" + token
	}

	return token
}
